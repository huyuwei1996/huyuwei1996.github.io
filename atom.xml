<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://huyuwei1996.github.io/</id>
    <title>Huyuweiçš„ä¸ªäººåšå®¢</title>
    <updated>2020-05-07T06:09:52.042Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://huyuwei1996.github.io/"/>
    <link rel="self" href="https://huyuwei1996.github.io/atom.xml"/>
    <subtitle>é€†æ°´è¡ŒèˆŸï¼Œä¸è¿›åˆ™é€€</subtitle>
    <logo>https://huyuwei1996.github.io/images/avatar.png</logo>
    <icon>https://huyuwei1996.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, Huyuweiçš„ä¸ªäººåšå®¢</rights>
    <entry>
        <title type="html"><![CDATA[æ€§èƒ½æµ‹è¯•æœºç¯å¢ƒæ­å»º]]></title>
        <id>https://huyuwei1996.github.io/post/xing-neng-ce-shi-ji-huan-jing-da-jian/</id>
        <link href="https://huyuwei1996.github.io/post/xing-neng-ce-shi-ji-huan-jing-da-jian/">
        </link>
        <updated>2020-05-06T07:39:58.000Z</updated>
        <content type="html"><![CDATA[<p>å¤‡æ³¨ï¼šä¸»æœºç³»ç»Ÿä¸ºCentOS 7</p>
<h1 id="å»ºè®®å…ˆæ›´æ–°æœºå™¨çš„yumæº">å»ºè®®å…ˆæ›´æ–°æœºå™¨çš„yumæº</h1>
<pre><code>sudo yum update -y
</code></pre>
<h1 id="ä¿®æ”¹ä¸»æœºåç§°">ä¿®æ”¹ä¸»æœºåç§°</h1>
<pre><code>sudo hostnamectl set-hostname PM133
echo &quot;127.0.0.1 PM133&quot; &gt;&gt; /etc/hosts
</code></pre>
<h1 id="å®‰è£…java">å®‰è£…Java</h1>
<h2 id="ä¸‹è½½oracle-jdk18">ä¸‹è½½Oracle JDK1.8</h2>
<p>ç”±äºç°åœ¨éœ€è¦ç™»å½•ä¸‹è½½ï¼Œå…ˆä»æµè§ˆå™¨ä¸­ç‚¹å‡»ä¸‹è½½åï¼Œå°†é“¾æ¥å¤åˆ¶æ›¿æ¢ä¸‹é¢çš„åœ°å€</p>
<pre><code>wget -N --no-cookies --no-check-certificate --header &quot;Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie&quot; &quot;https://download.oracle.com/otn/java/jdk/8u251-b08/3d5a2bb8f8d4428bbe94aed7ec7ae784/jdk-8u251-linux-x64.rpm?AuthParam=xxxxxxxxxxxxxxxx&quot;
</code></pre>
<h2 id="å®‰è£…jdk">å®‰è£…JDK</h2>
<pre><code>sudo yum install jdk-8u251-linux-x64.rpm -y
</code></pre>
<h2 id="é…ç½®é»˜è®¤java">é…ç½®é»˜è®¤Java</h2>
<p>å¦‚æœæœºå™¨æ²¡æœ‰é¢„è£…OpenJDKï¼Œå°±å¯ä»¥ç•¥è¿‡æ­¤æ­¥éª¤</p>
<pre><code>/usr/sbin/alternatives --config java
/usr/sbin/alternatives --config javac
</code></pre>
<p>å‘½ä»¤è¾“å…¥åæœ‰å¯¹åº”çš„èœå•é€‰æ‹©ï¼Œé€‰æ‹©å®‰è£…çš„Oracle JDKå³å¯</p>
<h2 id="æµ‹è¯•javaå®‰è£…æƒ…å†µ">æµ‹è¯•Javaå®‰è£…æƒ…å†µ</h2>
<pre><code>java -version
javac -version
</code></pre>
<p>é¢„æœŸç»“æœ</p>
<pre><code>~ java -version
java version &quot;1.8.0_251&quot;
Java(TM) SE Runtime Environment (build 1.8.0_251-b08)
Java HotSpot(TM) 64-Bit Server VM (build 25.251-b08, mixed mode)
~ javac -version
javac 1.8.0_251
</code></pre>
<h1 id="å®‰è£…gafana-serveråœ¨ä»ªè¡¨ç›˜çš„æœåŠ¡å™¨ä¸Šå®‰è£…">å®‰è£…gafana-serverï¼ˆåœ¨ä»ªè¡¨ç›˜çš„æœåŠ¡å™¨ä¸Šå®‰è£…ï¼‰</h1>
<h2 id="ä¸‹è½½å’Œå®‰è£…grafana">ä¸‹è½½å’Œå®‰è£…grafana</h2>
<pre><code>wget https://dl.grafana.com/oss/release/grafana-6.7.3-1.x86_64.rpm
sudo yum install grafana-6.7.3-1.x86_64.rpm -y
</code></pre>
<h2 id="ä¿®æ”¹åŒ¿åå¯ç›´æ¥æŸ¥çœ‹å±•ç¤ºé‡å¯æœåŠ¡">ä¿®æ”¹åŒ¿åå¯ç›´æ¥æŸ¥çœ‹å±•ç¤º&amp;é‡å¯æœåŠ¡</h2>
<pre><code>sudo vi /etc/grafana/grafana.ini
## ä¿®æ”¹é…ç½®æˆå¦‚ä¸‹çŠ¶æ€ï¼š
[auth.anonymous]
# enable anonymous access
enabled = true

# specify organization name that should be used for unauthenticated users
;org_name = Main Org.

# specify role for unauthenticated users
org_role = Viewer

## é‡å¯æœåŠ¡
sudo systemctl restart grafana-server
</code></pre>
<h1 id="æ·»åŠ influxæºæ‰€æœ‰æœåŠ¡å™¨">æ·»åŠ influxæºï¼ˆæ‰€æœ‰æœåŠ¡å™¨ï¼‰</h1>
<pre><code>cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/influxdb.repo
[influxdb]
name = InfluxDB Repository - RHEL \$releasever
baseurl = https://repos.influxdata.com/rhel/\$releasever/\$basearch/stable
enabled = 1
gpgcheck = 1
gpgkey = https://repos.influxdata.com/influxdb.key
EOF
</code></pre>
<h1 id="å®‰è£…influxdbåœ¨è´Ÿè´£æ”¶é›†æ•°æ®çš„æœåŠ¡å™¨ä¸Šå®‰è£…">å®‰è£…influxdbï¼ˆåœ¨è´Ÿè´£æ”¶é›†æ•°æ®çš„æœåŠ¡å™¨ä¸Šå®‰è£…ï¼‰</h1>
<h2 id="å®‰è£…influxdb">å®‰è£…influxdb</h2>
<pre><code>sudo yum install influxdb -y
</code></pre>
<h2 id="influxdbé…ç½®ä¿®æ”¹é‡å¯æœåŠ¡">influxdbé…ç½®ä¿®æ”¹&amp;é‡å¯æœåŠ¡</h2>
<pre><code>sudo vi /etc/influxdb/influxdb.conf
## æ‰¾åˆ°[[udp]]å¤„æ·»åŠ udpé…ç½®
## ä½¿ç”¨?[[udp]]å›è½¦ç›´æ¥æ‰¾åˆ°è¿™è¡Œ
[[udp]]
  # High-traffic UDP
  enabled = true
  bind-address = &quot;:8089&quot; # the bind address
  database = &quot;udp&quot; # Name of the database that will be written to
  batch-size = 5000 # will flush if this many points get buffered
  batch-timeout = &quot;1s&quot; # will flush at least this often even if the batch-size is not reached
  batch-pending = 100 # number of batches that may be pending in memory
  read-buffer = 8388608 # (8*1024*1024) UDP read buffer size
## é‡å¯æœåŠ¡
sudo systemctl restart influxdb
## æŸ¥çœ‹æœåŠ¡è¿è¡ŒçŠ¶æ€ï¼ˆè¯¦ç»†ï¼‰
sudo systemctl status influxdb -l
</code></pre>
<h1 id="å®‰è£…telegrafåœ¨éœ€è¦ç›‘æ§çš„æœåŠ¡å™¨ä¸Šå®‰è£…">å®‰è£…telegrafï¼ˆåœ¨éœ€è¦ç›‘æ§çš„æœåŠ¡å™¨ä¸Šå®‰è£…ï¼‰</h1>
<h2 id="å®‰è£…telegraf">å®‰è£…telegraf</h2>
<pre><code>sudo yum install telegraf -y
</code></pre>
<h2 id="telegrafé…ç½®ä¿®æ”¹é‡å¯æœåŠ¡">telegrafé…ç½®ä¿®æ”¹&amp;é‡å¯æœåŠ¡</h2>
<pre><code>sudo vi /etc/telegraf/telegraf.conf
## ä½¿ç”¨111ggå‘½ä»¤ç›´æ¥æ‰¾åˆ°è¿™è¡Œ
### ç›‘æ§æ•°æ®é€šè¿‡httpå†™åˆ°æ•°æ®åº“çš„é…ç½®ï¼š
  # urls = [&quot;udp://10.9.8.129:8089&quot;]
  urls = [&quot;http://10.9.8.129:8086&quot;]
### ç›‘æ§æ•°æ®é€šè¿‡udpå†™åˆ°æ•°æ®åº“çš„é…ç½®ï¼š
  urls = [&quot;udp://10.9.8.129:8089&quot;]
  # urls = [&quot;http://10.9.8.129:8086&quot;]
### å¦‚æœæ˜¯ç›‘æ§æœºå™¨å†™åˆ°è‡ªå·±çš„influxdbæ—¶ï¼Œurlå†™127.0.0.1ï¼Œå¦‚ï¼š
 # urls = [&quot;udp://127.0.0.1:8089&quot;]
  urls = [&quot;http://127.0.0.1:8086&quot;]

## httpå†™å…¥æ—¶çš„æ•°æ®åº“åç§°
database = &quot;telegraf&quot;å‰é¢å»æ‰#å·

## æ·»åŠ netstatç›‘æ§
## ä½¿ç”¨?inputs.netstatå›è½¦ç›´æ¥æ‰¾åˆ°è¿™è¡Œ
[[inputs.netstat]]å‰é¢å»æ‰#å·

## ä¿®æ”¹netç›‘æ§
## ä½¿ç”¨?inputs.net]å›è½¦ç›´æ¥æ‰¾åˆ°è¿™è¡Œ
[[inputs.net]]å‰é¢å»æ‰#å·
interfaces = [&quot;e*&quot;, &quot;lo&quot;]   # ä¿®æ”¹ç½‘å¡åç§°çš„åŒ¹é…

## é‡å¯æœåŠ¡
sudo systemctl restart telegraf
</code></pre>
<h1 id="å…³é—­é˜²ç«å¢™é˜²ç«å¢™å¼€æœºè‡ªå¯å…³æ‰åå°±å¯ä»¥è®¿é—®grafana-serverçš„3000ç«¯å£äº†">å…³é—­é˜²ç«å¢™&amp;é˜²ç«å¢™å¼€æœºè‡ªå¯ï¼ˆå…³æ‰åå°±å¯ä»¥è®¿é—®grafana-serverçš„3000ç«¯å£äº†ï¼‰</h1>
<pre><code>## æŸ¥çœ‹é˜²ç«å¢™
firewall-cmd --state
## å…³é—­firewall
systemctl stop firewalld.service
systemctl disable firewalld.service

## æˆ–è€…å¼€æ”¾3000ç«¯å£
firewall-cmd --zone=public --add-port=3000/tcp --permanent
firewall-cmd --reload
firewall-cmd --zone=public --query-port=3000/tcp
firewall-cmd --zone=public --list-ports
</code></pre>
<h1 id="ä¿®æ”¹ç³»ç»Ÿé™åˆ¶">ä¿®æ”¹ç³»ç»Ÿé™åˆ¶</h1>
<h2 id="è®¾å®šæ¯ä¸ªè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡">è®¾å®šæ¯ä¸ªè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡</h2>
<pre><code>## devä¸‹ä¿®æ”¹ç³»ç»Ÿå‚æ•°ï¼Œåˆ‡rootå°±ä¸ç”¨è¾“devå¯†ç äº†
sudo sudo su -

ulimit -n 65535
</code></pre>
<h2 id="ä¿®æ”¹å†…æ ¸å‚æ•°">ä¿®æ”¹å†…æ ¸å‚æ•°</h2>
<pre><code>sudo vi /etc/sysctl.conf

#è¡¨ç¤ºå¼€å¯SYN Cookiesã€‚å½“å‡ºç°SYNç­‰å¾…é˜Ÿåˆ—æº¢å‡ºæ—¶ï¼Œå¯ç”¨cookiesæ¥å¤„ç†ï¼Œå¯é˜²èŒƒå°‘é‡SYNæ”»å‡»ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­
net.ipv4.tcp_syncookies = 1
#è¡¨ç¤ºå¼€å¯é‡ç”¨ã€‚å…è®¸å°†TIME-WAIT socketsé‡æ–°ç”¨äºæ–°çš„TCPè¿æ¥ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­
net.ipv4.tcp_tw_reuse = 1
#è¡¨ç¤ºå¼€å¯é‡ç”¨ã€‚å…è®¸å°†TIME-WAIT socketsé‡æ–°ç”¨äºæ–°çš„TCPè¿æ¥ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­
net.ipv4.tcp_tw_recycle = 1
#è¡¨ç¤ºå¦‚æœå¥—æ¥å­—ç”±æœ¬ç«¯è¦æ±‚å…³é—­ï¼Œè¿™ä¸ªå‚æ•°å†³å®šäº†å®ƒä¿æŒåœ¨FIN-WAIT-2çŠ¶æ€çš„æ—¶é—´
net.ipv4.tcp_fin_timeout=30
#è¡¨ç¤ºå½“keepaliveèµ·ç”¨çš„æ—¶å€™ï¼ŒTCPå‘é€keepaliveæ¶ˆæ¯çš„é¢‘åº¦ã€‚ç¼ºçœæ˜¯2å°æ—¶ï¼Œæ”¹ä¸º20åˆ†é’Ÿ
net.ipv4.tcp_keepalive_time = 1200 
#è¡¨ç¤ºç”¨äºå‘å¤–è¿æ¥çš„ç«¯å£èŒƒå›´ã€‚ç¼ºçœæƒ…å†µä¸‹å¾ˆå°ï¼š32768åˆ°61000ï¼Œæ”¹ä¸º1024åˆ°65000
net.ipv4.ip_local_port_range = 1024 65000 
#è¡¨ç¤ºSYNé˜Ÿåˆ—çš„é•¿åº¦ï¼Œé»˜è®¤ä¸º1024ï¼ŒåŠ å¤§é˜Ÿåˆ—é•¿åº¦ä¸º8192ï¼Œå¯ä»¥å®¹çº³æ›´å¤šç­‰å¾…è¿æ¥çš„ç½‘ç»œè¿æ¥æ•°
net.ipv4.tcp_max_syn_backlog = 8192 
#è¡¨ç¤ºç³»ç»ŸåŒæ—¶ä¿æŒTIME_WAITå¥—æ¥å­—çš„æœ€å¤§æ•°é‡ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼ŒTIME_WAITå¥—æ¥å­—å°†ç«‹åˆ»è¢«æ¸…é™¤å¹¶æ‰“å°è­¦å‘Šä¿¡æ¯ã€‚é»˜è®¤ä¸º180000ï¼Œæ”¹ä¸º5000ã€‚å¯¹äºApacheã€Nginxç­‰æœåŠ¡å™¨ï¼Œä¸Šå‡ è¡Œçš„å‚æ•°å¯ä»¥å¾ˆå¥½åœ°å‡å°‘TIME_WAITå¥—æ¥å­—æ•°é‡ï¼Œä½†æ˜¯å¯¹äº Squidï¼Œæ•ˆæœå´ä¸å¤§ã€‚æ­¤é¡¹å‚æ•°å¯ä»¥æ§åˆ¶TIME_WAITå¥—æ¥å­—çš„æœ€å¤§æ•°é‡ï¼Œé¿å…SquidæœåŠ¡å™¨è¢«å¤§é‡çš„TIME_WAITå¥—æ¥å­—æ‹–æ­»ã€‚
net.ipv4.tcp_max_tw_buckets = 5000

## ç«‹å³ç”Ÿæ•ˆï¼ˆå…é‡å¯ï¼‰
sudo sysctl -p
</code></pre>
<h2 id="æé«˜çº¿ç¨‹çš„ä½¿ç”¨é™åˆ¶">æé«˜çº¿ç¨‹çš„ä½¿ç”¨é™åˆ¶</h2>
<pre><code>echo 999999 &gt; /proc/sys/kernel/pid_max
echo 1999999 &gt; /proc/sys/vm/max_map_count
</code></pre>
<h1 id="å®‰è£…jmeter">å®‰è£…Jmeter</h1>
<h2 id="ä¸‹è½½jmeterè¿™é‡Œä¸‹è½½æœ€æ–°çš„521">ä¸‹è½½Jmeterï¼ˆè¿™é‡Œä¸‹è½½æœ€æ–°çš„5.2.1ï¼‰</h2>
<pre><code>## è¿™é‡Œæˆ‘ä»¬æ”¾åœ¨softç›®å½•ä¸‹
mkdir soft &amp;&amp; cd soft
wget -N https://mirror.bit.edu.cn/apache//jmeter/binaries/apache-jmeter-5.2.1.zip
</code></pre>
<h2 id="è§£å‹é…ç½®ç¯å¢ƒå˜é‡">è§£å‹&amp;é…ç½®ç¯å¢ƒå˜é‡</h2>
<pre><code>unzip apache-jmeter-5.2.1.zip
## å¦‚æœæç¤ºä¸èƒ½ç”¨unzipå‘½ä»¤
sudo yum install zip unzip -y

## ä¿®æ”¹ç¯å¢ƒå˜é‡&amp;æ¿€æ´»ç¯å¢ƒå˜é‡ï¼ˆérootç”¨æˆ·çš„ï¼ŒJMETER_HOMEç±»ä¼¼/home/dev/soft/apache-jmeter-5.2.1ï¼‰
sudo vi /etc/profile

export JMETER_HOME=/root/soft/apache-jmeter-5.2.1
export CLASSPATH=$JMETER_HOME/lib/ext/ApacheJMeter_core.jar:$JMETER_HOME/lib/jorphan.jar:$CLASSPATH
export PATH=$JMETER_HOME/bin:$PATH

source /etc/profile
</code></pre>
<h2 id="æµ‹è¯•jmeterå®‰è£…æƒ…å†µ">æµ‹è¯•Jmeterå®‰è£…æƒ…å†µ</h2>
<pre><code>jmeter -v
</code></pre>
<p>é¢„æœŸç»“æœ</p>
<pre><code>~ jmeter -v
    _    ____   _    ____ _   _ _____       _ __  __ _____ _____ _____ ____
   / \  |  _ \ / \  / ___| | | | ____|     | |  \/  | ____|_   _| ____|  _ \
  / _ \ | |_) / _ \| |   | |_| |  _|    _  | | |\/| |  _|   | | |  _| | |_) |
 / ___ \|  __/ ___ \ |___|  _  | |___  | |_| | |  | | |___  | | | |___|  _ &lt;
/_/   \_\_| /_/   \_\____|_| |_|_____|  \___/|_|  |_|_____| |_| |_____|_| \_\ 5.2.1

Copyright (c) 1999-2019 The Apache Software Foundation
</code></pre>
<h2 id="ä¿®æ”¹jmeterçš„jvmå‚æ•°">ä¿®æ”¹Jmeterçš„JVMå‚æ•°</h2>
<h3 id="ä¿®æ”¹jmetershå’Œjmeterwinä¿®æ”¹jmeterbat">ä¿®æ”¹jmeter.shå’Œjmeterï¼Œwinä¿®æ”¹jmeter.bat</h3>
<pre><code>cd soft/apache-jmeter-5.2.1/bin
vi jmeter.sh
vi jmeter
</code></pre>
<h3 id="heapæœ€å¤šè®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„ä¸€åŠ8gæœºå™¨è®¾ç½®4g16gæœºå™¨è®¾ç½®8g">heapæœ€å¤šè®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„ä¸€åŠï¼Œ8Gæœºå™¨è®¾ç½®4Gï¼Œ16Gæœºå™¨è®¾ç½®8G</h3>
<pre><code>JVM_ARGS=&quot;-Xms4G -Xmx4G -Xmn512m&quot;
JVM_ARGS=&quot;-Xms8G -Xmx8G -Xmn512m&quot;
</code></pre>
<h3 id="ä¿®æ”¹æ¯çº¿ç¨‹å ç”¨çš„æ ˆç©ºé—´ç›®å‰æ²¡æ”¹">ä¿®æ”¹æ¯çº¿ç¨‹å ç”¨çš„æ ˆç©ºé—´ï¼ˆç›®å‰æ²¡æ”¹ï¼‰</h3>
<pre><code>JVM_ARGS=&quot;-XX:ThreadStackSize=400k&quot;
</code></pre>
<p>æ¯çº¿ç¨‹ä½¿ç”¨400KBçš„æ ˆç©ºé—´ï¼Œæ¯”ç¼ºçœçš„1MBèŠ‚çœäº†çº¦60%ï¼Œä½†æ˜¯å®é™…ä¸Šåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ ˆç©ºé—´çš„ä½¿ç”¨ä¹Ÿä¸å®Œå…¨æ˜¯çº¿æ€§çš„ï¼Œå…·ä½“çš„èŠ‚çœä¸‹æ¥çš„æ ˆç©ºé—´éœ€è¦é€šè¿‡è¯•éªŒã€‚</p>
<h2 id="ä¿®æ”¹jmeter-server">ä¿®æ”¹jmeter-server</h2>
<h3 id="å…ˆç”¨ifconfigæ‰¾ä¸‹ç½‘å¡åç§°æ¯”å¦‚æ˜¯em1winä¿®æ”¹jmeter-serverbat">å…ˆç”¨ifconfigæ‰¾ä¸‹ç½‘å¡åç§°ï¼Œæ¯”å¦‚æ˜¯em1ï¼Œwinä¿®æ”¹jmeter-server.bat</h3>
<pre><code>vi jmeter-server

# æ·»åŠ ä¸‹é¢å†…å®¹åˆ°æœ€åä¸€è¡Œçš„å‰é¢å³å¯
ip=`ifconfig em1 | awk -F &quot;[ :]+&quot; 'NR==2{print $3}'`
RMI_HOST_DEF=-Djava.rmi.server.hostname=$ip
</code></pre>
<h2 id="ä¿®æ”¹ä¸»æ§æœºjmeterproperties">ä¿®æ”¹ä¸»æ§æœºjmeter.properties</h2>
<pre><code>vi jmeter.properties

## 258ggæ‰¾åˆ°è¿™è¡Œï¼Œå¦‚æœæœ‰å¤šå°ä»£ç†æœºï¼Œè¿™é‡Œéœ€è¦æŠŠæ‰€æœ‰çš„ä»£ç†æœºçš„IPåœ°å€å’Œç«¯å£å·éƒ½åŠ å…¥è¿›æ¥
remote_hosts=127.0.0.1,10.9.8.133
server.rmi.ssl.disable=true
</code></pre>
<h2 id="slaveæœºå™¨jmeter-serverå¯åŠ¨å…³é—­è„šæœ¬jmeter-serverè‡ªå¯åŠ¨">slaveæœºå™¨ï¼šjmeter-serverå¯åŠ¨/å…³é—­è„šæœ¬&amp;jmeter-serverè‡ªå¯åŠ¨</h2>
<p>ä¾‹å¦‚133æœºå™¨ï¼šï¼ˆé»˜è®¤rootç”¨æˆ·æ—¶ï¼‰</p>
<pre><code>## å¯åŠ¨è„šæœ¬
vi /root/soft/startup.sh

#!/bin/bash
source /etc/profile
cd /root/
rm -f jmeter-server.log
jmeter-server &amp;
exit
</code></pre>
<p>ä¾‹å¦‚108æœºå™¨ï¼šï¼ˆé»˜è®¤devç”¨æˆ·æ—¶ï¼‰</p>
<pre><code>## å¯åŠ¨è„šæœ¬
vi /home/dev/soft/startup.sh

#!/bin/bash
source /etc/profile
cd /home/dev/
rm -f jmeter-server.log
jmeter-server &amp;
exit
</code></pre>
<p>ä¸‹é¢è·¯å¾„æ ¹æ®ç”¨æˆ·å‚è€ƒä¸Šé¢ä¾‹å­</p>
<pre><code>## å…³é—­è„šæœ¬
vi /root/soft/shutdown.sh

#!/bin/bash
str=`ps -ef | grep jmeter-server | grep -v &quot;grep&quot;|awk '{print $2}'`
kill -9 $str
if [ &quot;$?&quot; -eq 0 ]; then
	echo &quot;killed pid is &quot;$str
    echo &quot;kill success&quot;
else
    echo &quot;kill failed&quot;
fi

## æ·»åŠ è‡ªå¯åŠ¨æœåŠ¡
sudo vi /usr/lib/systemd/system/jmeter-server.service

[Unit]
Description=jmeter-server project
After=jmeter-server.service
  
[Service]
Type=forking
User=root
Group=root
ExecStart=/root/soft/startup.sh
ExecReload=
ExecStop=/root/soft/shutdown.sh
PrivateTmp=true
  
[Install]
WantedBy=multi-user.target

## èµ‹æƒé™ï¼Œæ¿€æ´»æœåŠ¡ï¼ˆè®¾ç½®è‡ªå¯åŠ¨ï¼‰
sudo chmod 754 /usr/lib/systemd/system/jmeter-server.service
sudo systemctl enable jmeter-server.service

## å…¶ä»–ç›¸å…³å‘½ä»¤
sudo systemctl start jmeter-server  # å¯åŠ¨æœåŠ¡
sudo systemctl stop jmeter-server # åœæ­¢æœåŠ¡
sudo systemctl status jmeter-server # æŸ¥çœ‹æœåŠ¡è¿è¡Œ
sudo systemctl restart jmeter-server # é‡å¯æœåŠ¡

sudo systemctl disable jmeter-server.service # ç¦ç”¨æœåŠ¡è‡ªå¯åŠ¨
</code></pre>
<h2 id="ä¸»æ§æœºæ‰§è¡Œæ—¶">ä¸»æ§æœºæ‰§è¡Œæ—¶ï¼š</h2>
<pre><code>jmeter -n -t test.jmx -R server1IP,server2IP
## ä¾‹ï¼š
jmeter -n -t test.jmx -R 10.9.8.133
</code></pre>
<h1 id="å…¬å¸æœºå™¨åˆ‡rootç”¨æˆ·æ–¹å¼">å…¬å¸æœºå™¨åˆ‡rootç”¨æˆ·æ–¹å¼</h1>
<pre><code>## ä¸çŸ¥é“æ€ä¹ˆé…ç½®çš„ï¼Œåæ­£éœ€è¦2ä¸ªsudo
sudo sudo su -
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[iterm2é…ç½®lrzsz]]></title>
        <id>https://huyuwei1996.github.io/post/iterm2-pei-zhi-lrzsz/</id>
        <link href="https://huyuwei1996.github.io/post/iterm2-pei-zhi-lrzsz/">
        </link>
        <updated>2020-04-30T06:28:48.000Z</updated>
        <content type="html"><![CDATA[<h1 id="ä¸‹è½½è„šæœ¬">ä¸‹è½½è„šæœ¬</h1>
<p>å°†iterm2-send-zmodem.sh &amp; iterm2-recv-zmodem.shæ”¾åˆ°/usr/local/bin/</p>
<pre><code>git clone https://github.com/huyuwei1996/iterm2-zmodem.git
cd iterm2-zmodem
cp *.sh /usr/local/bin
</code></pre>
<h1 id="é…ç½®iterm2-trigger">é…ç½®iterm2 Trigger</h1>
<p>é€‰æ‹©Profiles &gt; Default &gt; Advanced &gt; Triggers &gt; Edit</p>
<h2 id="å‘é€-sz">å‘é€ sz</h2>
<pre><code>Regular expression: rz waiting to receive.\*\*B0100 (æ³¨æ„è¿™é‡Œæ˜¯è¿™æ ·)
Action: Run Silent Coprocess
Parameters: /usr/local/bin/iterm2-send-zmodem.sh
</code></pre>
<h2 id="æ¥æ”¶-rz">æ¥æ”¶ rz</h2>
<pre><code>Regular expression:\*\*B00000000000000
Action: Run Silent Coprocess
Parameters: /usr/local/bin/iterm2-recv-zmodem.sh
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[JPype1 - python2.7ä¸‹macå’Œwinå®‰è£…è§£å†³]]></title>
        <id>https://huyuwei1996.github.io/post/jpype1-python27-xia-mac-he-win-an-zhuang-jie-jue/</id>
        <link href="https://huyuwei1996.github.io/post/jpype1-python27-xia-mac-he-win-an-zhuang-jie-jue/">
        </link>
        <updated>2020-04-13T07:29:21.000Z</updated>
        <content type="html"><![CDATA[<h1 id="ç›´æ¥æŒ‡å®šç‰ˆæœ¬å®‰è£…">ç›´æ¥æŒ‡å®šç‰ˆæœ¬å®‰è£…</h1>
<p>python2.7å°±å®‰è£…0.7.1åŠå…¶ä»¥ä¸‹ç‰ˆæœ¬</p>
<pre><code>pip2 install jpype1==0.7.1
or
pip2 install jpype1==0.7.0
</code></pre>
<h2 id="winé€šè¿‡å‹ç¼©åŒ…å®‰è£…">winé€šè¿‡å‹ç¼©åŒ…å®‰è£…</h2>
<p><code>pip2 install jpype1</code>å®‰è£…å¤±è´¥<br>
åœ¨<a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#jpype">https://www.lfd.uci.edu/~gohlke/pythonlibs/#jpype</a> ä¸‹è½½cp27ä¹Ÿå°±æ˜¯å¯¹åº”python2.7çš„<br>
<img src="https://huyuwei1996.github.io//post-images/1586763262234.png" alt="" loading="lazy"><br>
ç„¶åä½¿ç”¨<code>pip2 install JPype1-0.7.1-cp27-cp27m-win_amd64.whl</code>å®‰è£…</p>
<h2 id="macé€šè¿‡ç¼–è¯‘å®‰è£…">macé€šè¿‡ç¼–è¯‘å®‰è£…</h2>
<p><code>pip2 install jpype1</code>å®‰è£…å¤±è´¥<br>
åœ¨<a href="https://github.com/jpype-project/jpype/releases">https://github.com/jpype-project/jpype/releases</a> ä¸‹è½½v0.7.1çš„Source code<br>
(zip)<br>
å› ä¸º0.7.2å¼€å§‹ä¸æ”¯æŒpython2.7ï¼Œæ‰€ä»¥å®‰è£…æ—¶å€™ä¼šä¸€ç›´æŠ¥é”™ã€‚<br>
è¿™é‡Œé€‰æ‹©ä¸‹è½½æºç è§£å‹åï¼Œç›´æ¥ç¼–è¯‘å®‰è£…</p>
<pre><code>cd JPype1-0.7.1
python2 setup.py install
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è®°ä¸€æ¬¡libimobiledeviceå®‰è£…é—®é¢˜]]></title>
        <id>https://huyuwei1996.github.io/post/ji-yi-ci-libimobiledevice-an-zhuang-wen-ti/</id>
        <link href="https://huyuwei1996.github.io/post/ji-yi-ci-libimobiledevice-an-zhuang-wen-ti/">
        </link>
        <updated>2020-04-13T07:12:26.000Z</updated>
        <content type="html"><![CDATA[<p><img src="https://huyuwei1996.github.io//post-images/1586762260492.png" alt="" loading="lazy"><br>
ç›´æ¥è®°å½•ä¸‹ç»“æœå§ï¼Œå›¾ä¸­3f64bbdc857512944b5bc7bb36f4d59191c25d14ä¸€ç›´ç¼–è¯‘æŠ¥é”™ï¼Œafc.cçš„é—®é¢˜ã€‚</p>
<pre><code>brew install -v --HEAD libimobiledevice
# å®‰è£…å¤±è´¥åï¼Œåˆ‡æ¢ä¸Šä¸€ä¸ªcommit
cd /Users/huyuwei/Library/Caches/Homebrew/libimobiledevice--git
git checkout c0576790378daa45d43335d44c5caff04c270c94
brew install gnutls
brew install libgcrypt
./autogen.sh --disable-openssl
make
make install
</code></pre>
<p>è§£å†³ç»è¿‡ï¼š</p>
<pre><code>brew install -v --HEAD libimobiledevice
# å®‰è£…æ–°ç‰ˆæ—¶å€™ï¼Œä¸­é—´å®‰è£…äº†ä¾èµ–python@3.8ï¼Œå’Œopenssl@1.1ï¼Œbrewè‡ªåŠ¨å®‰è£…å¤±è´¥åï¼Œå°è¯•ä»¥ä¸‹å‘½ä»¤ä¾ç„¶å¤±è´¥
brew install -v --HEAD --fetch --build-from-source libimobiledevice
# åé¢æ‰“ç®—æ‰‹åŠ¨ç¼–è¯‘ï¼Œé“¾æ¥ç›¸å…³ä¾èµ–åº“
cd /Users/huyuwei/Library/Caches/Homebrew/libimobiledevice--git
export LDFLAGS=&quot;-L/usr/local/opt/python@3.8/lib:$LDFLAGS&quot;
export LDFLAGS=&quot;-L/usr/local/opt/openssl@1.1/lib:$LDFLAGS&quot;
export CPPFLAGS=&quot;-I/usr/local/opt/openssl@1.1/include&quot;
./autogen.sh
# æç¤ºopensslç‰ˆæœ¬ä¸å¯¹(å¦‚ä¸‹)ï¼Œå¯èƒ½æ˜¯è¿™é‡ŒLDFLAGSè®¾ç½®çš„é—®é¢˜ï¼Œä¸å¤ªä¼šå¼„
checking for openssl &gt;= 0.9.8... no
configure: error: OpenSSL support explicitly requested but OpenSSL could not be found
# æœ€åæ‰¾åˆ°ä¸€ç§æ–¹å¼
brew install gnutls
brew install libgcrypt
./autogen.sh --disable-openssl
make
make install
</code></pre>
<p>ç„¶åideviceinstallerè¿™ä¸ªç»ˆäºæ¢å¤æ­£å¸¸äº†<br>
<img src="https://huyuwei1996.github.io//post-images/1586763744560.png" alt="" loading="lazy"></p>
<p>ç¬¬äºŒå¤©çš„æ–°commitè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚cf5a60d75c2108261a6e848b352f798c1422349c<br>
è¿™ä¹ˆå€’éœ‰çš„äº‹æƒ…åˆšå¥½é‡åˆ°äº†ï¼Œæˆ‘è¿˜ç¡¬è£…ä¸Šäº†ï¼Œå¤ªç´¯äº†ğŸ™</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Sublime Textå¸¸ç”¨æ’ä»¶è®°å½•]]></title>
        <id>https://huyuwei1996.github.io/post/sublime-text-chang-yong-cha-jian-ji-lu/</id>
        <link href="https://huyuwei1996.github.io/post/sublime-text-chang-yong-cha-jian-ji-lu/">
        </link>
        <updated>2020-04-10T03:40:25.000Z</updated>
        <content type="html"><![CDATA[<h6 id="å¸¸ç”¨package">å¸¸ç”¨Package</h6>
<blockquote>
<p>Package Control<br>
ConvertToUTF8(æ”¯æŒGBK)<br>
Codecs33(æ”¯æŒGB2312)<br>
HTML-CSS-JS Prettify<br>
Keymaps<br>
MarkdownTOC<br>
Nodejs<br>
Python 3<br>
PackageResourceViewer<br>
SideBarEnhancements<br>
Material Theme<br>
Theme - Monokai Pro</p>
</blockquote>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[pythonåˆ¤æ–­ç³»ç»Ÿç±»å‹]]></title>
        <id>https://huyuwei1996.github.io/post/python-pan-duan-xi-tong-lei-xing/</id>
        <link href="https://huyuwei1996.github.io/post/python-pan-duan-xi-tong-lei-xing/">
        </link>
        <updated>2020-04-10T03:40:12.000Z</updated>
        <content type="html"><![CDATA[<h2 id="osname">os.name</h2>
<p>è¯¥å˜é‡è¿”å›å½“å‰æ“ä½œç³»ç»Ÿçš„ç±»å‹</p>
<pre><code class="language-python">import os
print(os.name)
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:center">ç³»ç»Ÿ</th>
<th style="text-align:center">è¿”å›å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">linux</td>
<td style="text-align:center">posix</td>
</tr>
<tr>
<td style="text-align:center">windows</td>
<td style="text-align:center">nt</td>
</tr>
<tr>
<td style="text-align:center">javaè™šæ‹Ÿæœº</td>
<td style="text-align:center">java</td>
</tr>
</tbody>
</table>
<h2 id="sysplatform">sys.platform</h2>
<p>è¯¥å˜é‡è¿”å›å½“å‰ç³»ç»Ÿçš„å¹³å°æ ‡è¯†</p>
<pre><code class="language-python">import sys
print(sys.platform)
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:center">ç³»ç»Ÿ</th>
<th style="text-align:center">è¿”å›å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">linux</td>
<td style="text-align:center">linux</td>
</tr>
<tr>
<td style="text-align:center">windows</td>
<td style="text-align:center">win32</td>
</tr>
<tr>
<td style="text-align:center">windows/cygwin</td>
<td style="text-align:center">cygwin</td>
</tr>
<tr>
<td style="text-align:center">mac os x</td>
<td style="text-align:center">darwin</td>
</tr>
</tbody>
</table>
<h2 id="platformsystem">platform.system()</h2>
<p>è¿”å›å½“å‰æ“ä½œç³»ç»Ÿçš„åå­—</p>
<pre><code class="language-python">import platform
print(platform.system())
</code></pre>
<p>ä¾‹å¦‚Linuxï¼ŒWindowsï¼ŒJavaï¼ŒDarwinï¼Œ...</p>
<pre><code>platform.platform() Â  Â  #è·å–æ“ä½œç³»ç»Ÿåç§°åŠç‰ˆæœ¬å·ï¼Œå¦‚'Darwin-19.2.0-x86_64-i386-64bit'

platform.version() Â  Â  Â  Â #è·å–æ“ä½œç³»ç»Ÿç‰ˆæœ¬å·ï¼Œå¦‚'Darwin Kernel Version 19.2.0: Sat Nov  9 03:47:04 PST 2019; root:xnu-6153.61.1~20/RELEASE_X86_64'

platform.architecture() Â  Â #è·å–æ“ä½œç³»ç»Ÿçš„ä½æ•°ï¼Œå¦‚('64bit', '')

platform.machine() Â  Â  #è®¡ç®—æœºç±»å‹ï¼Œå¦‚'x86_64'

platform.node() Â  Â  Â  Â  Â #è®¡ç®—æœºçš„ç½‘ç»œåç§°

platform.processor() Â  Â #è®¡ç®—æœºå¤„ç†å™¨ä¿¡æ¯ï¼Œå¦‚'i386'

platform.uname() Â  Â  Â  Â #åŒ…å«ä¸Šé¢æ‰€æœ‰çš„ä¿¡æ¯æ±‡æ€»
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[oh-my-zshå®‰è£…]]></title>
        <id>https://huyuwei1996.github.io/post/oh-my-zsh-an-zhuang/</id>
        <link href="https://huyuwei1996.github.io/post/oh-my-zsh-an-zhuang/">
        </link>
        <updated>2020-04-10T03:39:41.000Z</updated>
        <content type="html"><![CDATA[<h2 id="å®‰è£…æ­¥éª¤">å®‰è£…æ­¥éª¤</h2>
<ol>
<li>zshå®‰è£…</li>
<li>oh-my-zshå®‰è£…ã€é«˜äº®&amp;è‡ªåŠ¨è¡¥å…¨æ’ä»¶å®‰è£…</li>
<li>autojumpæ’ä»¶å®‰è£…</li>
</ol>
<h2 id="å®‰è£…è„šæœ¬">å®‰è£…è„šæœ¬</h2>
<p>MacOS:<br>
macè‡ªå¸¦zsh</p>
<pre><code>sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&quot;

git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting

brew install autojump

sed -i &quot;&quot; &quot;s/plugins=(git)/plugins=(git zsh-autosuggestions zsh-syntax-highlighting autojump)/g&quot; ~/.zshrc
source ~/.zshrc
</code></pre>
<p>Ubuntu:</p>
<pre><code>sudo apt update -y
sudo apt install zsh -y
sudo apt install git -y

sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&quot;

git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting

sudo apt install autojump -y

sed -i &quot;s/plugins=(git)/plugins=(git zsh-autosuggestions zsh-syntax-highlighting autojump)/g&quot; ~/.zshrc
source ~/.zshrc
</code></pre>
<p>CentOS:</p>
<pre><code>sudo yum update -y
sudo yum install zsh -y
sudo yum install git -y

sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&quot;

git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting

sudo yum install -y autojump-zsh

sed -i &quot;s/plugins=(git)/plugins=(git zsh-autosuggestions zsh-syntax-highlighting autojump)/g&quot; ~/.zshrc
source ~/.zshrc
</code></pre>
<h3 id="å…¶ä»–é…ç½®">å…¶ä»–é…ç½®</h3>
<p>å¦‚æœæ²¡æœ‰åˆ‡æ¢shellæˆåŠŸ<br>
<code>chsh -s /bin/zsh</code><br>
å¸¸æ˜¾ä¸»æœºåhostname<br>
<code>echo &quot;PROMPT=%m\ \$PROMPT&quot; &gt;&gt; .zshrc</code></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Mac launchctl å¯åŠ¨è¿›ç¨‹]]></title>
        <id>https://huyuwei1996.github.io/post/mac-launchctl-qi-dong-jin-cheng/</id>
        <link href="https://huyuwei1996.github.io/post/mac-launchctl-qi-dong-jin-cheng/">
        </link>
        <updated>2020-04-10T03:39:04.000Z</updated>
        <content type="html"><![CDATA[<h1>plistæ–‡ä»¶åˆ†å¸ƒ</h1>
<pre><code class="">/System/Library/LaunchDaemons/ ï¼ˆSystem-wide daemons provided by OS Xï¼‰
å…¶ä¸­ apacheçš„httpdç¨‹åºå¯åŠ¨é…ç½®æ–‡ä»¶ org.apache.httpd.plist å°±åœ¨è¿™é‡Œã€‚

/System/Library/LaunchAgents/ ï¼ˆç”±Mac OS Xä¸ºç”¨æˆ·å®šä¹‰çš„ä»»åŠ¡é¡¹ï¼‰

/Library/LaunchDaemons ï¼ˆç”±ç®¡ç†å‘˜å®šä¹‰çš„å®ˆæŠ¤è¿›ç¨‹ä»»åŠ¡é¡¹ ï¼‰

/Library/LaunchAgents ï¼ˆç”±ç®¡ç†å‘˜ä¸ºç”¨æˆ·å®šä¹‰çš„ä»»åŠ¡é¡¹ ï¼‰
å¦‚æœæ”¾åˆ°/Library/LaunchAgents/ä¸‹é¢çš„è¯ï¼Œå°±æ˜¯ä¸€å¼€æœºå°±å¯åŠ¨å“¦ï½

~/Library/LaunchAgents ï¼ˆ ç”±ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ä»»åŠ¡é¡¹ ï¼‰
</code></pre>
<h1>launchctl å¸¸ç”¨å‘½ä»¤</h1>
<pre><code class="">1.æ˜¾ç¤ºå½“å‰çš„å¯åŠ¨è„šæœ¬
launchctl list

2.å¼€æœºæ—¶è‡ªåŠ¨å¯åŠ¨ApacheæœåŠ¡å™¨
sudo launchctl load -w /System/Library/LaunchDaemons/org.apache.httpd.plist

3.è®¾ç½®å¼€æœºå¯åŠ¨å¹¶ç«‹å³å¯åŠ¨æ”¹æœåŠ¡
launchctl load -w   **.pist 

4. è®¾ç½®å¼€æœºå¯åŠ¨ä½†ä¸ç«‹å³å¯åŠ¨æœåŠ¡ 
launchctl load **.pist 

5. åœæ­¢æ­£åœ¨è¿è¡Œçš„å¯åŠ¨è„šæœ¬
sudo launchctl unload [path/to/script]
6. å†åŠ ä¸Š-wé€‰é¡¹å³å¯å»é™¤å¼€æœºå¯åŠ¨
sudo launchctl unload -w [path/to/script]
</code></pre>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Linuxå†…æ ¸å‚æ•°ä¼˜åŒ–]]></title>
        <id>https://huyuwei1996.github.io/post/linux-nei-he-can-shu-you-hua/</id>
        <link href="https://huyuwei1996.github.io/post/linux-nei-he-can-shu-you-hua/">
        </link>
        <updated>2019-11-01T07:22:54.000Z</updated>
        <summary type="html"><![CDATA[<blockquote>
<p>è½¬è‡ªâ€”â€”é«˜å¹¶å‘æƒ…å†µä¸‹Linuxç³»ç»ŸåŠkernelå‚æ•°ä¼˜åŒ–ï¼š<a href="https://www.linuxidc.com/Linux/2018-08/153369.htm">https://www.linuxidc.com/Linux/2018-08/153369.htm</a></p>
<p>è°ƒæ•´äº†ä¸€ä¸‹æ–¹ä¾¿è‡ªå·±æŸ¥çœ‹</p>
</blockquote>
]]></summary>
        <content type="html"><![CDATA[<blockquote>
<p>è½¬è‡ªâ€”â€”é«˜å¹¶å‘æƒ…å†µä¸‹Linuxç³»ç»ŸåŠkernelå‚æ•°ä¼˜åŒ–ï¼š<a href="https://www.linuxidc.com/Linux/2018-08/153369.htm">https://www.linuxidc.com/Linux/2018-08/153369.htm</a></p>
<p>è°ƒæ•´äº†ä¸€ä¸‹æ–¹ä¾¿è‡ªå·±æŸ¥çœ‹</p>
</blockquote>
<!-- more -->
<p>ä¼—æ‰€å‘¨çŸ¥åœ¨é»˜è®¤å‚æ•°æƒ…å†µä¸‹Linuxå¯¹é«˜å¹¶å‘æ”¯æŒå¹¶ä¸å¥½ï¼Œä¸»è¦å—é™äºå•è¿›ç¨‹æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶ã€å†…æ ¸TCPå‚æ•°æ–¹é¢å’ŒIOäº‹ä»¶åˆ†é…æœºåˆ¶ç­‰ã€‚ä¸‹é¢å°±ä»å‡ æ–¹é¢æ¥è°ƒæ•´ä½¿Linuxç³»ç»Ÿèƒ½å¤Ÿæ”¯æŒé«˜å¹¶å‘ç¯å¢ƒã€‚</p>
<h4 id="iptablesç›¸å…³">Iptablesç›¸å…³</h4>
<p>å¦‚éå¿…é¡»ï¼Œå…³æ‰æˆ–å¸è½½iptablesé˜²ç«å¢™ï¼Œå¹¶é˜»æ­¢kernelåŠ è½½iptablesæ¨¡å—ã€‚è¿™äº›æ¨¡å—ä¼šå½±å“å¹¶å‘æ€§èƒ½ã€‚</p>
<h4 id="å•è¿›ç¨‹æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶">å•è¿›ç¨‹æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶</h4>
<p>ä¸€èˆ¬çš„å‘è¡Œç‰ˆï¼Œé™åˆ¶å•è¿›ç¨‹æœ€å¤§å¯ä»¥æ‰“å¼€1024ä¸ªæ–‡ä»¶ï¼Œè¿™æ˜¯è¿œè¿œä¸èƒ½æ»¡è¶³é«˜å¹¶å‘éœ€æ±‚çš„ï¼Œè°ƒæ•´è¿‡ç¨‹å¦‚ä¸‹:</p>
<p>åœ¨#å·æç¤ºç¬¦ä¸‹æ•²å…¥:</p>
<pre><code># ulimit â€“n 65535
</code></pre>
<p>å°†rootå¯åŠ¨çš„å•ä¸€è¿›ç¨‹çš„æœ€å¤§å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æ•°è®¾ç½®ä¸º65535ä¸ªã€‚å¦‚æœç³»ç»Ÿå›æ˜¾ç±»ä¼¼äºâ€œOperationnotpermittedâ€ä¹‹ç±»çš„è¯ï¼Œè¯´æ˜ä¸Šè¿°é™åˆ¶ä¿®æ”¹å¤±è´¥ï¼Œå®é™…ä¸Šæ˜¯å› ä¸ºåœ¨ä¸­æŒ‡å®šçš„æ•°å€¼è¶…è¿‡äº†Linuxç³»ç»Ÿå¯¹è¯¥ç”¨æˆ·æ‰“å¼€æ–‡ä»¶æ•°çš„è½¯é™åˆ¶æˆ–ç¡¬é™åˆ¶ã€‚å› æ­¤ï¼Œå°±éœ€è¦ä¿®æ”¹Linuxç³»ç»Ÿå¯¹ç”¨æˆ·çš„å…³äºæ‰“å¼€æ–‡ä»¶æ•°çš„è½¯é™åˆ¶å’Œç¡¬é™åˆ¶ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼Œä¿®æ”¹limits.confæ–‡ä»¶ï¼Œå¹¶æ·»åŠ ï¼š</p>
<pre><code># vim /etc/security/limits.conf
* soft nofile 65535
* hard nofile 65535
</code></pre>
<p>å¯ä»¥å†™æˆ</p>
<pre><code>* - nofile 65535
</code></pre>
<p>å…¶ä¸­'*'å·è¡¨ç¤ºä¿®æ”¹æ‰€æœ‰ç”¨æˆ·çš„é™åˆ¶ï¼›softæˆ–hardæŒ‡å®šè¦ä¿®æ”¹è½¯é™åˆ¶è¿˜æ˜¯ç¡¬é™åˆ¶ï¼›65536åˆ™æŒ‡å®šäº†æƒ³è¦ä¿®æ”¹çš„æ–°çš„é™åˆ¶å€¼ï¼Œå³æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°(è¯·æ³¨æ„è½¯é™åˆ¶å€¼è¦å°äºæˆ–ç­‰äºç¡¬é™åˆ¶)ã€‚ä¿®æ”¹å®Œåä¿å­˜æ–‡ä»¶ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼Œä¿®æ”¹/etc/pam.d/loginæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹è¡Œï¼š</p>
<pre><code># vim /etc/pam.d/login
session required /lib/security/pam_limits.so

# 64ä½ç³»ç»Ÿåº”è¯¥ä¸ºè¿™ä¸ªè·¯å¾„
session required /lib64/security/pam_limits.so
</code></pre>
<p>è¿™æ˜¯å‘Šè¯‰Linuxåœ¨ç”¨æˆ·å®Œæˆç³»ç»Ÿç™»å½•åï¼Œåº”è¯¥è°ƒç”¨pam_limits.soæ¨¡å—æ¥è®¾ç½®ç³»ç»Ÿå¯¹è¯¥ç”¨æˆ·å¯ä½¿ç”¨çš„å„ç§èµ„æºæ•°é‡çš„æœ€å¤§é™åˆ¶(åŒ…æ‹¬ç”¨æˆ·å¯æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°é™åˆ¶)ï¼Œè€Œpam_limits.soæ¨¡å—å°±ä¼šä»/etc/security/limits.confæ–‡ä»¶ä¸­è¯»å–é…ç½®æ¥è®¾ç½®è¿™äº›é™åˆ¶å€¼ã€‚ä¿®æ”¹å®Œåä¿å­˜æ­¤æ–‡ä»¶ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼ŒæŸ¥çœ‹Linuxç³»ç»Ÿçº§çš„æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<pre><code># cat /proc/sys/fs/file-max
32568
</code></pre>
<p>è¿™è¡¨æ˜è¿™å°Linuxç³»ç»Ÿæœ€å¤šå…è®¸åŒæ—¶æ‰“å¼€(å³åŒ…å«æ‰€æœ‰ç”¨æˆ·æ‰“å¼€æ–‡ä»¶æ•°æ€»å’Œ)32568ä¸ªæ–‡ä»¶ï¼Œæ˜¯Linuxç³»ç»Ÿçº§ç¡¬é™åˆ¶ï¼Œæ‰€æœ‰ç”¨æˆ·çº§çš„æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶éƒ½ä¸åº”è¶…è¿‡è¿™ä¸ªæ•°å€¼ã€‚é€šå¸¸è¿™ä¸ªç³»ç»Ÿçº§ç¡¬é™åˆ¶æ˜¯Linuxç³»ç»Ÿåœ¨å¯åŠ¨æ—¶æ ¹æ®ç³»ç»Ÿç¡¬ä»¶èµ„æºçŠ¶å†µè®¡ç®—å‡ºæ¥çš„æœ€ä½³çš„æœ€å¤§åŒæ—¶æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€è¦ï¼Œä¸åº”è¯¥ä¿®æ”¹æ­¤é™åˆ¶ï¼Œé™¤éæƒ³ä¸ºç”¨æˆ·çº§æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶è®¾ç½®è¶…è¿‡æ­¤é™åˆ¶çš„å€¼ã€‚ä¿®æ”¹æ­¤ç¡¬é™åˆ¶çš„æ–¹æ³•æ˜¯ä¿®æ”¹/etc/sysctl.confæ–‡ä»¶å†…fs.file-max= 131072</p>
<p>è¿™æ˜¯è®©Linuxåœ¨å¯åŠ¨å®Œæˆåå¼ºè¡Œå°†ç³»ç»Ÿçº§æ‰“å¼€æ–‡ä»¶æ•°ç¡¬é™åˆ¶è®¾ç½®ä¸º131072ã€‚ä¿®æ”¹å®Œåä¿å­˜æ­¤æ–‡ä»¶ã€‚</p>
<p>å®Œæˆä¸Šè¿°æ­¥éª¤åé‡å¯ç³»ç»Ÿï¼Œä¸€èˆ¬æƒ…å†µä¸‹å°±å¯ä»¥å°†Linuxç³»ç»Ÿå¯¹æŒ‡å®šç”¨æˆ·çš„å•ä¸€è¿›ç¨‹å…è®¸åŒæ—¶æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°é™åˆ¶è®¾ä¸ºæŒ‡å®šçš„æ•°å€¼ã€‚å¦‚æœé‡å¯åç”¨ulimit-nå‘½ä»¤æŸ¥çœ‹ç”¨æˆ·å¯æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶ä»ç„¶ä½äºä¸Šè¿°æ­¥éª¤ä¸­è®¾ç½®çš„æœ€å¤§å€¼ï¼Œè¿™å¯èƒ½æ˜¯å› ä¸ºåœ¨ç”¨æˆ·ç™»å½•è„šæœ¬/etc/profileä¸­ä½¿ç”¨ulimit-nå‘½ä»¤å·²ç»å°†ç”¨æˆ·å¯åŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æ•°åšäº†é™åˆ¶ã€‚ç”±äºé€šè¿‡ulimit-nä¿®æ”¹ç³»ç»Ÿå¯¹ç”¨æˆ·å¯åŒæ—¶æ‰“å¼€æ–‡ä»¶çš„æœ€å¤§æ•°é™åˆ¶æ—¶ï¼Œæ–°ä¿®æ”¹çš„å€¼åªèƒ½å°äºæˆ–ç­‰äºä¸Šæ¬¡ulimit-nè®¾ç½®çš„å€¼ï¼Œå› æ­¤æƒ³ç”¨æ­¤å‘½ä»¤å¢å¤§è¿™ä¸ªé™åˆ¶å€¼æ˜¯ä¸å¯èƒ½çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœæœ‰ä¸Šè¿°é—®é¢˜å­˜åœ¨ï¼Œå°±åªèƒ½å»æ‰“å¼€/etc/profileè„šæœ¬æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾æ˜¯å¦ä½¿ç”¨äº†ulimit-né™åˆ¶äº†ç”¨æˆ·å¯åŒæ—¶æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°é‡ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™åˆ é™¤è¿™è¡Œå‘½ä»¤ï¼Œæˆ–è€…å°†å…¶è®¾ç½®çš„å€¼æ”¹ä¸ºåˆé€‚çš„å€¼ï¼Œç„¶åä¿å­˜æ–‡ä»¶ï¼Œç”¨æˆ·é€€å‡ºå¹¶é‡æ–°ç™»å½•ç³»ç»Ÿå³å¯ã€‚</p>
<p>é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œå°±ä¸ºæ”¯æŒé«˜å¹¶å‘TCPè¿æ¥å¤„ç†çš„é€šè®¯å¤„ç†ç¨‹åºè§£é™¤å…³äºæ‰“å¼€æ–‡ä»¶æ•°é‡æ–¹é¢çš„ç³»ç»Ÿé™åˆ¶ã€‚</p>
<h4 id="å†…æ ¸tcpå‚æ•°æ–¹é¢">å†…æ ¸TCPå‚æ•°æ–¹é¢</h4>
<p>Linuxç³»ç»Ÿä¸‹ï¼ŒTCPè¿æ¥æ–­å¼€åï¼Œä¼šä»¥TIME_WAITçŠ¶æ€ä¿ç•™ä¸€å®šçš„æ—¶é—´ï¼Œç„¶åæ‰ä¼šé‡Šæ”¾ç«¯å£ã€‚å½“å¹¶å‘è¯·æ±‚è¿‡å¤šçš„æ—¶å€™ï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡çš„TIME_WAITçŠ¶æ€çš„è¿æ¥ï¼Œæ— æ³•åŠæ—¶æ–­å¼€çš„è¯ï¼Œä¼šå ç”¨å¤§é‡çš„ç«¯å£èµ„æºå’ŒæœåŠ¡å™¨èµ„æºã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä¼˜åŒ–TCPçš„å†…æ ¸å‚æ•°ï¼Œæ¥åŠæ—¶å°†TIME_WAITçŠ¶æ€çš„ç«¯å£æ¸…ç†æ‰ã€‚</p>
<p>ä¸‹é¢ä»‹ç»çš„æ–¹æ³•åªå¯¹æ‹¥æœ‰å¤§é‡TIME_WAITçŠ¶æ€çš„è¿æ¥å¯¼è‡´ç³»ç»Ÿèµ„æºæ¶ˆè€—æœ‰æ•ˆï¼Œå¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µä¸‹ï¼Œæ•ˆæœå¯èƒ½ä¸æ˜æ˜¾ã€‚å¯ä»¥ä½¿ç”¨netstatå‘½ä»¤å»æŸ¥TIME_WAITçŠ¶æ€çš„è¿æ¥çŠ¶æ€ï¼Œè¾“å…¥ä¸‹é¢çš„ç»„åˆå‘½ä»¤ï¼ŒæŸ¥çœ‹å½“å‰TCPè¿æ¥çš„çŠ¶æ€å’Œå¯¹åº”çš„è¿æ¥æ•°é‡ï¼š</p>
<pre><code># netstat -n | awk '/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}'
</code></pre>
<p>è¿™ä¸ªå‘½ä»¤ä¼šè¾“å‡ºç±»ä¼¼ä¸‹é¢çš„ç»“æœï¼š</p>
<p>LAST_ACK16<br>
SYN_RECV348<br>
ESTABLISHED70<br>
FIN_WAIT1229<br>
FIN_WAIT230<br>
CLOSING33<br>
TIME_WAIT18098</p>
<p>æˆ‘ä»¬åªç”¨å…³å¿ƒTIME_WAITçš„ä¸ªæ•°ï¼Œåœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæœ‰18000å¤šä¸ªTIME_WAITï¼Œè¿™æ ·å°±å ç”¨äº†18000å¤šä¸ªç«¯å£ã€‚è¦çŸ¥é“ç«¯å£çš„æ•°é‡åªæœ‰65535ä¸ªï¼Œå ç”¨ä¸€ä¸ªå°‘ä¸€ä¸ªï¼Œä¼šä¸¥é‡çš„å½±å“åˆ°åç»§çš„æ–°è¿æ¥ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±æœ‰å¿…è¦è°ƒæ•´ä¸‹Linuxçš„TCPå†…æ ¸å‚æ•°ï¼Œè®©ç³»ç»Ÿæ›´å¿«çš„é‡Šæ”¾TIME_WAITè¿æ¥ã€‚</p>
<p>ç¼–è¾‘é…ç½®æ–‡ä»¶:/etc/sysctl.confï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼ŒåŠ å…¥ä¸‹é¢çš„å‡ è¡Œå†…å®¹ï¼š</p>
<pre><code># vim /etc/sysctl.conf
net.ipv4.tcp_syncookies= 1
net.ipv4.tcp_tw_reuse= 1
net.ipv4.tcp_tw_recycle= 1
net.ipv4.tcp_fin_timeout= 30
</code></pre>
<p>è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œè®©å†…æ ¸å‚æ•°ç”Ÿæ•ˆï¼š</p>
<pre><code># sysctl -p
</code></pre>
<p>ç®€å•çš„è¯´æ˜ä¸Šé¢çš„å‚æ•°çš„å«ä¹‰ï¼š</p>
<pre><code>net.ipv4.tcp_syncookies= 1
#è¡¨ç¤ºå¼€å¯SYNCookiesã€‚å½“å‡ºç°SYNç­‰å¾…é˜Ÿåˆ—æº¢å‡ºæ—¶ï¼Œå¯ç”¨cookiesæ¥å¤„ç†ï¼Œå¯é˜²èŒƒå°‘é‡SYN***ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ï¼›

net.ipv4.tcp_tw_reuse= 1
#è¡¨ç¤ºå¼€å¯é‡ç”¨ã€‚å…è®¸å°†TIME-WAITsocketsé‡æ–°ç”¨äºæ–°çš„TCPè¿æ¥ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ï¼›

net.ipv4.tcp_tw_recycle= 1
#è¡¨ç¤ºå¼€å¯TCPè¿æ¥ä¸­TIME-WAITsocketsçš„å¿«é€Ÿå›æ”¶ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ï¼›

net.ipv4.tcp_fin_timeout
#ä¿®æ”¹ç³»çµ±é»˜è®¤çš„TIMEOUT æ—¶é—´ã€‚
</code></pre>
<p>åœ¨ç»è¿‡è¿™æ ·çš„è°ƒæ•´ä¹‹åï¼Œé™¤äº†ä¼šè¿›ä¸€æ­¥æå‡æœåŠ¡å™¨çš„è´Ÿè½½èƒ½åŠ›ä¹‹å¤–ï¼Œè¿˜èƒ½å¤Ÿé˜²å¾¡å°æµé‡ç¨‹åº¦çš„DoSã€CCå’ŒSYN***ã€‚</p>
<p>æ­¤å¤–ï¼Œå¦‚æœä½ çš„è¿æ¥æ•°æœ¬èº«å°±å¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥å†ä¼˜åŒ–ä¸€ä¸‹TCPçš„å¯ä½¿ç”¨ç«¯å£èŒƒå›´ï¼Œè¿›ä¸€æ­¥æå‡æœåŠ¡å™¨çš„å¹¶å‘èƒ½åŠ›ã€‚ä¾ç„¶æ˜¯å¾€ä¸Šé¢çš„å‚æ•°æ–‡ä»¶ä¸­ï¼ŒåŠ å…¥ä¸‹é¢è¿™äº›é…ç½®ï¼š</p>
<pre><code>net.ipv4.tcp_keepalive_time= 1200
net.ipv4.ip_local_port_range= 1024 65535
net.ipv4.tcp_max_syn_backlog= 8192
net.ipv4.tcp_max_tw_buckets= 5000
</code></pre>
<p>è¿™å‡ ä¸ªå‚æ•°ï¼Œå»ºè®®åªåœ¨æµé‡éå¸¸å¤§çš„æœåŠ¡å™¨ä¸Šå¼€å¯ï¼Œä¼šæœ‰æ˜¾è‘—çš„æ•ˆæœã€‚ä¸€èˆ¬çš„æµé‡å°çš„æœåŠ¡å™¨ä¸Šï¼Œæ²¡æœ‰å¿…è¦å»è®¾ç½®è¿™å‡ ä¸ªå‚æ•°ã€‚</p>
<pre><code>net.ipv4.tcp_keepalive_time= 1200
#è¡¨ç¤ºå½“keepaliveèµ·ç”¨çš„æ—¶å€™ï¼ŒTCPå‘é€keepaliveæ¶ˆæ¯çš„é¢‘åº¦ã€‚ç¼ºçœæ˜¯2å°æ—¶ï¼Œæ”¹ä¸º20åˆ†é’Ÿã€‚

net.ipv4.ip_local_port_range= 1024 65535
#è¡¨ç¤ºç”¨äºå‘å¤–è¿æ¥çš„ç«¯å£èŒƒå›´ã€‚ç¼ºçœæƒ…å†µä¸‹å¾ˆå°ï¼Œæ”¹ä¸º1024åˆ°65535ã€‚

net.ipv4.tcp_max_syn_backlog= 8192
#è¡¨ç¤ºSYNé˜Ÿåˆ—çš„é•¿åº¦ï¼Œé»˜è®¤ä¸º1024ï¼ŒåŠ å¤§é˜Ÿåˆ—é•¿åº¦ä¸º8192ï¼Œå¯ä»¥å®¹çº³æ›´å¤šç­‰å¾…è¿æ¥çš„ç½‘ç»œè¿æ¥æ•°ã€‚

net.ipv4.tcp_max_tw_buckets= 5000
#è¡¨ç¤ºç³»ç»ŸåŒæ—¶ä¿æŒTIME_WAITçš„æœ€å¤§æ•°é‡ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼ŒTIME_WAITå°†ç«‹åˆ»è¢«æ¸…é™¤å¹¶æ‰“å°è­¦å‘Šä¿¡æ¯ã€‚é»˜è®¤ä¸º180000ï¼Œæ”¹ä¸º5000ã€‚æ­¤é¡¹å‚æ•°å¯ä»¥æ§åˆ¶TIME_WAITçš„æœ€å¤§æ•°é‡ï¼Œåªè¦è¶…å‡ºäº†ã€‚
</code></pre>
<h4 id="å†…æ ¸å…¶ä»–tcpå‚æ•°è¯´æ˜">å†…æ ¸å…¶ä»–TCPå‚æ•°è¯´æ˜ï¼š</h4>
<pre><code>net.ipv4.tcp_max_syn_backlog= 65536
#è®°å½•çš„é‚£äº›å°šæœªæ”¶åˆ°å®¢æˆ·ç«¯ç¡®è®¤ä¿¡æ¯çš„è¿æ¥è¯·æ±‚çš„æœ€å¤§å€¼ã€‚å¯¹äºæœ‰128Må†…å­˜çš„ç³»ç»Ÿè€Œè¨€ï¼Œç¼ºçœå€¼æ˜¯1024ï¼Œå°å†…å­˜çš„ç³»ç»Ÿåˆ™æ˜¯128ã€‚

net.core.netdev_max_backlog= 32768
#æ¯ä¸ªç½‘ç»œæ¥å£æ¥æ”¶æ•°æ®åŒ…çš„é€Ÿç‡æ¯”å†…æ ¸å¤„ç†è¿™äº›åŒ…çš„é€Ÿç‡å¿«æ—¶ï¼Œå…è®¸é€åˆ°é˜Ÿåˆ—çš„æ•°æ®åŒ…çš„æœ€å¤§æ•°ç›®ã€‚

net.core.somaxconn= 32768
#ä¾‹å¦‚webåº”ç”¨ä¸­listenå‡½æ•°çš„backlogé»˜è®¤ä¼šç»™æˆ‘ä»¬å†…æ ¸å‚æ•°çš„net.core.somaxconné™åˆ¶åˆ°128ï¼Œè€Œnginxå®šä¹‰çš„NGX_LISTEN_BACKLOGé»˜è®¤ä¸º511ï¼Œæ‰€ä»¥æœ‰å¿…è¦è°ƒæ•´è¿™ä¸ªå€¼ã€‚

net.core.wmem_default= 8388608
net.core.rmem_default= 8388608
net.core.rmem_max= 16777216          #æœ€å¤§socketè¯»buffer,å¯å‚è€ƒçš„ä¼˜åŒ–å€¼:873200
net.core.wmem_max= 16777216          #æœ€å¤§socketå†™buffer,å¯å‚è€ƒçš„ä¼˜åŒ–å€¼:873200
net.ipv4.tcp_timestsmps= 0
#æ—¶é—´æˆ³å¯ä»¥é¿å…åºåˆ—å·çš„å·ç»•ã€‚ä¸€ä¸ª1Gbpsçš„é“¾è·¯è‚¯å®šä¼šé‡åˆ°ä»¥å‰ç”¨è¿‡çš„åºåˆ—å·ã€‚æ—¶é—´æˆ³èƒ½å¤Ÿè®©å†…æ ¸æ¥å—è¿™ç§â€œå¼‚å¸¸â€çš„æ•°æ®åŒ…ã€‚è¿™é‡Œéœ€è¦å°†å…¶å…³æ‰ã€‚

net.ipv4.tcp_synack_retries= 2
#ä¸ºäº†æ‰“å¼€å¯¹ç«¯çš„è¿æ¥ï¼Œå†…æ ¸éœ€è¦å‘é€ä¸€ä¸ªSYNå¹¶é™„å¸¦ä¸€ä¸ªå›åº”å‰é¢ä¸€ä¸ªSYNçš„ACKã€‚ä¹Ÿå°±æ˜¯æ‰€è°“ä¸‰æ¬¡æ¡æ‰‹ä¸­çš„ç¬¬äºŒæ¬¡æ¡æ‰‹ã€‚è¿™ä¸ªè®¾ç½®å†³å®šäº†å†…æ ¸æ”¾å¼ƒè¿æ¥ä¹‹å‰å‘é€SYN+ACKåŒ…çš„æ•°é‡ã€‚

net.ipv4.tcp_syn_retries= 2
#åœ¨å†…æ ¸æ”¾å¼ƒå»ºç«‹è¿æ¥ä¹‹å‰å‘é€SYNåŒ…çš„æ•°é‡ã€‚

#net.ipv4.tcp_tw_len= 1
net.ipv4.tcp_tw_reuse= 1
# å¼€å¯é‡ç”¨ã€‚å…è®¸å°†TIME-WAITsocketsé‡æ–°ç”¨äºæ–°çš„TCPè¿æ¥ã€‚

net.ipv4.tcp_wmem= 8192 436600 873200
# TCPå†™buffer,å¯å‚è€ƒçš„ä¼˜åŒ–å€¼:8192 436600 873200

net.ipv4.tcp_rmem  = 32768 436600 873200
# TCPè¯»buffer,å¯å‚è€ƒçš„ä¼˜åŒ–å€¼:32768 436600 873200

net.ipv4.tcp_mem= 94500000 91500000 92700000
# åŒæ ·æœ‰3ä¸ªå€¼,æ„æ€æ˜¯:
net.ipv4.tcp_mem[0]:ä½äºæ­¤å€¼ï¼ŒTCPæ²¡æœ‰å†…å­˜å‹åŠ›ã€‚
net.ipv4.tcp_mem[1]:åœ¨æ­¤å€¼ä¸‹ï¼Œè¿›å…¥å†…å­˜å‹åŠ›é˜¶æ®µã€‚
net.ipv4.tcp_mem[2]:é«˜äºæ­¤å€¼ï¼ŒTCPæ‹’ç»åˆ†é…socketã€‚
ä¸Šè¿°å†…å­˜å•ä½æ˜¯é¡µï¼Œè€Œä¸æ˜¯å­—èŠ‚ã€‚å¯å‚è€ƒçš„ä¼˜åŒ–å€¼æ˜¯:7864321048576 1572864

net.ipv4.tcp_max_orphans= 3276800
#ç³»ç»Ÿä¸­æœ€å¤šæœ‰å¤šå°‘ä¸ªTCPå¥—æ¥å­—ä¸è¢«å…³è”åˆ°ä»»ä½•ä¸€ä¸ªç”¨æˆ·æ–‡ä»¶å¥æŸ„ä¸Šã€‚
å¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œè¿æ¥å°†å³åˆ»è¢«å¤ä½å¹¶æ‰“å°å‡ºè­¦å‘Šä¿¡æ¯ã€‚
è¿™ä¸ªé™åˆ¶ä»…ä»…æ˜¯ä¸ºäº†é˜²æ­¢ç®€å•çš„DoS***ï¼Œä¸èƒ½è¿‡åˆ†ä¾é å®ƒæˆ–è€…äººä¸ºåœ°å‡å°è¿™ä¸ªå€¼ï¼Œ
æ›´åº”è¯¥å¢åŠ è¿™ä¸ªå€¼(å¦‚æœå¢åŠ äº†å†…å­˜ä¹‹å)ã€‚

net.ipv4.tcp_fin_timeout= 30
#å¦‚æœå¥—æ¥å­—ç”±æœ¬ç«¯è¦æ±‚å…³é—­ï¼Œè¿™ä¸ªå‚æ•°å†³å®šäº†å®ƒä¿æŒåœ¨FIN-WAIT-2çŠ¶æ€çš„æ—¶é—´ã€‚å¯¹ç«¯å¯ä»¥å‡ºé”™å¹¶æ°¸è¿œä¸å…³é—­è¿æ¥ï¼Œç”šè‡³æ„å¤–å½“æœºã€‚ç¼ºçœå€¼æ˜¯60ç§’ã€‚2.2 å†…æ ¸çš„é€šå¸¸å€¼æ˜¯180ç§’ï¼Œä½ å¯ä»¥æŒ‰è¿™ä¸ªè®¾ç½®ï¼Œä½†è¦è®°ä½çš„æ˜¯ï¼Œå³ä½¿ä½ çš„æœºå™¨æ˜¯ä¸€ä¸ªè½»è½½çš„WEBæœåŠ¡å™¨ï¼Œä¹Ÿæœ‰å› ä¸ºå¤§é‡çš„æ­»å¥—æ¥å­—è€Œå†…å­˜æº¢å‡ºçš„é£é™©ï¼ŒFIN-WAIT-2çš„å±é™©æ€§æ¯”FIN-WAIT-1è¦å°ï¼Œå› ä¸ºå®ƒæœ€å¤šåªèƒ½åƒæ‰1.5Kå†…å­˜ï¼Œä½†æ˜¯å®ƒä»¬çš„ç”Ÿå­˜æœŸé•¿äº›ã€‚
</code></pre>
<p>åŒæ—¶è¿˜æ¶‰åŠåˆ°ä¸€ä¸ªTCP æ‹¥å¡ç®—æ³•çš„é—®é¢˜ï¼Œä½ å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹æœ¬æœºæä¾›çš„æ‹¥å¡ç®—æ³•æ§åˆ¶æ¨¡å—ï¼š</p>
<p>sysctlnet.ipv4.tcp_available_congestion_control</p>
<p>å¯¹äºå‡ ç§ç®—æ³•çš„åˆ†æï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒä¸‹ï¼šTCPæ‹¥å¡æ§åˆ¶ç®—æ³•çš„ä¼˜ç¼ºç‚¹ã€é€‚ç”¨ç¯å¢ƒã€æ€§èƒ½åˆ†æï¼Œæ¯”å¦‚é«˜å»¶æ—¶å¯ä»¥è¯•ç”¨hyblaï¼Œä¸­ç­‰å»¶æ—¶å¯ä»¥è¯•ç”¨htcpç®—æ³•ç­‰ã€‚</p>
<pre><code>å¦‚æœæƒ³è®¾ç½®TCP æ‹¥å¡ç®—æ³•ä¸ºhybla
net.ipv4.tcp_congestion_control=hybla

é¢å¤–çš„ï¼Œå¯¹äºå†…æ ¸ç‰ˆé«˜äºäº3.7.1çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å¯tcp_fastopenï¼š
net.ipv4.tcp_fastopen= 3
</code></pre>
<h4 id="ioäº‹ä»¶åˆ†é…æœºåˆ¶">IOäº‹ä»¶åˆ†é…æœºåˆ¶</h4>
<p>åœ¨Linuxå¯ç”¨é«˜å¹¶å‘TCPè¿æ¥ï¼Œå¿…é¡»ç¡®è®¤åº”ç”¨ç¨‹åºæ˜¯å¦ä½¿ç”¨äº†åˆé€‚çš„ç½‘ç»œI/OæŠ€æœ¯å’ŒI/Oäº‹ä»¶åˆ†æ´¾æœºåˆ¶ã€‚å¯ç”¨çš„I/OæŠ€æœ¯æœ‰åŒæ­¥I/Oï¼Œéé˜»å¡å¼åŒæ­¥I/Oï¼Œä»¥åŠå¼‚æ­¥I/Oã€‚åœ¨é«˜TCPå¹¶å‘çš„æƒ…å½¢ä¸‹ï¼Œå¦‚æœä½¿ç”¨åŒæ­¥I/Oï¼Œè¿™ä¼šä¸¥é‡é˜»å¡ç¨‹åºçš„è¿è½¬ï¼Œé™¤éä¸ºæ¯ä¸ªTCPè¿æ¥çš„I/Oåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‚ä½†æ˜¯ï¼Œè¿‡å¤šçš„çº¿ç¨‹åˆä¼šå› ç³»ç»Ÿå¯¹çº¿ç¨‹çš„è°ƒåº¦é€ æˆå·¨å¤§å¼€é”€ã€‚å› æ­¤ï¼Œåœ¨é«˜TCPå¹¶å‘çš„æƒ…å½¢ä¸‹ä½¿ç”¨åŒæ­¥I/Oæ˜¯ä¸å¯å–çš„ï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨éé˜»å¡å¼åŒæ­¥I/Oæˆ–å¼‚æ­¥I/Oã€‚éé˜»å¡å¼åŒæ­¥I/Oçš„æŠ€æœ¯åŒ…æ‹¬ä½¿ç”¨select()ï¼Œpoll()ï¼Œepollç­‰æœºåˆ¶ã€‚å¼‚æ­¥I/Oçš„æŠ€æœ¯å°±æ˜¯ä½¿ç”¨AIOã€‚</p>
<p>ä»I/Oäº‹ä»¶åˆ†æ´¾æœºåˆ¶æ¥çœ‹ï¼Œä½¿ç”¨select()æ˜¯ä¸åˆé€‚çš„ï¼Œå› ä¸ºå®ƒæ‰€æ”¯æŒçš„å¹¶å‘è¿æ¥æ•°æœ‰é™(é€šå¸¸åœ¨1024ä¸ªä»¥å†…)ã€‚å¦‚æœè€ƒè™‘æ€§èƒ½ï¼Œpoll()ä¹Ÿæ˜¯ä¸åˆé€‚çš„ï¼Œå°½ç®¡å®ƒå¯ä»¥æ”¯æŒçš„è¾ƒé«˜çš„TCPå¹¶å‘æ•°ï¼Œä½†æ˜¯ç”±äºå…¶é‡‡ç”¨â€œè½®è¯¢â€æœºåˆ¶ï¼Œå½“å¹¶å‘æ•°è¾ƒé«˜æ—¶ï¼Œå…¶è¿è¡Œæ•ˆç‡ç›¸å½“ä½ï¼Œå¹¶å¯èƒ½å­˜åœ¨I/Oäº‹ä»¶åˆ†æ´¾ä¸å‡ï¼Œå¯¼è‡´éƒ¨åˆ†TCPè¿æ¥ä¸Šçš„I/Oå‡ºç°â€œé¥¥é¥¿â€ç°è±¡ã€‚è€Œå¦‚æœä½¿ç”¨epollæˆ–AIOï¼Œåˆ™æ²¡æœ‰ä¸Šè¿°é—®é¢˜(æ—©æœŸLinuxå†…æ ¸çš„AIOæŠ€æœ¯å®ç°æ˜¯é€šè¿‡åœ¨å†…æ ¸ä¸­ä¸ºæ¯ä¸ªI/Oè¯·æ±‚åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥å®ç°çš„ï¼Œè¿™ç§å®ç°æœºåˆ¶åœ¨é«˜å¹¶å‘TCPè¿æ¥çš„æƒ…å½¢ä¸‹ä½¿ç”¨å…¶å®ä¹Ÿæœ‰ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚ä½†åœ¨æœ€æ–°çš„Linuxå†…æ ¸ä¸­ï¼ŒAIOçš„å®ç°å·²ç»å¾—åˆ°æ”¹è¿›)ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨å¼€å‘æ”¯æŒé«˜å¹¶å‘TCPè¿æ¥çš„Linuxåº”ç”¨ç¨‹åºæ—¶ï¼Œåº”å°½é‡ä½¿ç”¨epollæˆ–AIOæŠ€æœ¯æ¥å®ç°å¹¶å‘çš„TCPè¿æ¥ä¸Šçš„I/Oæ§åˆ¶ï¼Œè¿™å°†ä¸ºæå‡ç¨‹åºå¯¹é«˜å¹¶å‘TCPè¿æ¥çš„æ”¯æŒæä¾›æœ‰æ•ˆçš„I/Oä¿è¯ã€‚</p>
<p>ç»è¿‡è¿™æ ·çš„ä¼˜åŒ–é…ç½®ä¹‹åï¼ŒæœåŠ¡å™¨çš„TCPå¹¶å‘å¤„ç†èƒ½åŠ›ä¼šæ˜¾è‘—æé«˜ã€‚ä»¥ä¸Šé…ç½®ä»…ä¾›å‚è€ƒï¼Œç”¨äºç”Ÿäº§ç¯å¢ƒè¯·æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µè°ƒæ•´è§‚å¯Ÿå†è°ƒæ•´ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¸¸ç”¨ç®—æ³•é€Ÿè®°-Python]]></title>
        <id>https://huyuwei1996.github.io/post/chang-yong-suan-fa-su-ji-python/</id>
        <link href="https://huyuwei1996.github.io/post/chang-yong-suan-fa-su-ji-python/">
        </link>
        <updated>2019-09-05T15:38:26.000Z</updated>
        <content type="html"><![CDATA[<h1 id="10-åå¤§ç»å…¸æ’åºç®—æ³•">1.0 åå¤§ç»å…¸æ’åºç®—æ³•</h1>
<figure data-type="image" tabindex="1"><img src="https://www.runoob.com/wp-content/uploads/2019/03/sort.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="2"><img src="https://www.runoob.com/wp-content/uploads/2019/03/0B319B38-B70E-4118-B897-74EFA7E368F9.png" alt="img" loading="lazy"></figure>
<h1 id="11-å†’æ³¡æ’åº">1.1 å†’æ³¡æ’åº</h1>
<figure data-type="image" tabindex="3"><img src="https://www.runoob.com/wp-content/uploads/2019/03/bubbleSort.gif" alt="img" loading="lazy"></figure>
<pre><code class="language-python">def bubbleSort(arr):
    for i in range(1, len(arr)):
        for j in range(0, len(arr)-i):
            if arr[j] &gt; arr[j+1]:
                arr[j], arr[j + 1] = arr[j + 1], arr[j]
    return arr
</code></pre>
<h1 id="12-é€‰æ‹©æ’åº">1.2 é€‰æ‹©æ’åº</h1>
<figure data-type="image" tabindex="4"><img src="https://www.runoob.com/wp-content/uploads/2019/03/selectionSort.gif" alt="img" loading="lazy"></figure>
<pre><code class="language-python">def selectionSort(arr):
    for i in range(len(arr) - 1):
        # è®°å½•æœ€å°æ•°çš„ç´¢å¼•
        minIndex = i
        for j in range(i + 1, len(arr)):
            if arr[j] &lt; arr[minIndex]:
                minIndex = j
        # i ä¸æ˜¯æœ€å°æ•°æ—¶ï¼Œå°† i å’Œæœ€å°æ•°è¿›è¡Œäº¤æ¢
        if i != minIndex:
            arr[i], arr[minIndex] = arr[minIndex], arr[i]
    return arr
</code></pre>
<h1 id="13-æ’å…¥æ’åº">1.3 æ’å…¥æ’åº</h1>
<figure data-type="image" tabindex="5"><img src="https://www.runoob.com/wp-content/uploads/2019/03/insertionSort.gif" alt="img" loading="lazy"></figure>
<pre><code class="language-python">def insertionSort(arr):
    for i in range(len(arr)):
        preIndex = i-1
        current = arr[i]
        while preIndex &gt;= 0 and arr[preIndex] &gt; current:
            arr[preIndex+1] = arr[preIndex]
            preIndex-=1
        arr[preIndex+1] = current
    return arr
</code></pre>
<h1 id="14-å¸Œå°”æ’åº">1.4 å¸Œå°”æ’åº</h1>
<figure data-type="image" tabindex="6"><img src="https://www.runoob.com/wp-content/uploads/2019/03/Sorting_shellsort_anim.gif" alt="img" loading="lazy"></figure>
<pre><code class="language-python">def shellSort(arr):
    import math
    gap=1
    while(gap &lt; len(arr)/3):
        gap = gap*3+1
    while gap &gt; 0:
        for i in range(gap,len(arr)):
            temp = arr[i]
            j = i-gap
            while j &gt;=0 and arr[j] &gt; temp:
                arr[j+gap]=arr[j]
                j-=gap
            arr[j+gap] = temp
        gap = math.floor(gap/3)
    return arr
</code></pre>
<h1 id="15-å½’å¹¶æ’åº">1.5 å½’å¹¶æ’åº</h1>
<figure data-type="image" tabindex="7"><img src="https://www.runoob.com/wp-content/uploads/2019/03/mergeSort.gif" alt="img" loading="lazy"></figure>
<pre><code class="language-python">def mergeSort(arr):
    import math
    if(len(arr)&lt;2):
        return arr
    middle = math.floor(len(arr)/2)
    left, right = arr[0:middle], arr[middle:]
    return merge(mergeSort(left), mergeSort(right))

def merge(left,right):
    result = []
    while left and right:
        if left[0] &lt;= right[0]:
            result.append(left.pop(0))
        else:
            result.append(right.pop(0));
    while left:
        result.append(left.pop(0))
    while right:
        result.append(right.pop(0));
    return result
</code></pre>
<h1 id="16-å¿«é€Ÿæ’åº">1.6 å¿«é€Ÿæ’åº</h1>
<figure data-type="image" tabindex="8"><img src="https://www.runoob.com/wp-content/uploads/2019/03/quickSort.gif" alt="img" loading="lazy"></figure>
<pre><code class="language-python">def quickSort(arr, left=None, right=None):
    left = 0 if not isinstance(left,(int, float)) else left
    right = len(arr)-1 if not isinstance(right,(int, float)) else right
    if left &lt; right:
        partitionIndex = partition(arr, left, right)
        quickSort(arr, left, partitionIndex-1)
        quickSort(arr, partitionIndex+1, right)
    return arr

def partition(arr, left, right):
    pivot = left
    index = pivot+1
    i = index
    while  i &lt;= right:
        if arr[i] &lt; arr[pivot]:
            swap(arr, i, index)
            index+=1
        i+=1
    swap(arr,pivot,index-1)
    return index-1

def swap(arr, i, j):
    arr[i], arr[j] = arr[j], arr[i]
</code></pre>
<h1 id="17-å †æ’åº">1.7 å †æ’åº</h1>
<figure data-type="image" tabindex="9"><img src="https://www.runoob.com/wp-content/uploads/2019/03/heapSort.gif" alt="img" loading="lazy"></figure>
<pre><code class="language-python">def buildMaxHeap(arr):
    import math
    for i in range(math.floor(len(arr)/2),-1,-1):
        heapify(arr,i)

def heapify(arr, i):
    left = 2*i+1
    right = 2*i+2
    largest = i
    if left &lt; arrLen and arr[left] &gt; arr[largest]:
        largest = left
    if right &lt; arrLen and arr[right] &gt; arr[largest]:
        largest = right

    if largest != i:
        swap(arr, i, largest)
        heapify(arr, largest)

def swap(arr, i, j):
    arr[i], arr[j] = arr[j], arr[i]

def heapSort(arr):
    global arrLen
    arrLen = len(arr)
    buildMaxHeap(arr)
    for i in range(len(arr)-1,0,-1):
        swap(arr,0,i)
        arrLen -=1
        heapify(arr, 0)
    return arr
</code></pre>
<h1 id="18-è®¡æ•°æ’åº">1.8 è®¡æ•°æ’åº</h1>
<figure data-type="image" tabindex="10"><img src="https://www.runoob.com/wp-content/uploads/2019/03/countingSort.gif" alt="img" loading="lazy"></figure>
<pre><code class="language-python">def countingSort(arr, maxValue):
    bucketLen = maxValue+1
    bucket = [0]*bucketLen
    sortedIndex =0
    arrLen = len(arr)
    for i in range(arrLen):
        if not bucket[arr[i]]:
            bucket[arr[i]]=0
        bucket[arr[i]]+=1
    for j in range(bucketLen):
        while bucket[j]&gt;0:
            arr[sortedIndex] = j
            sortedIndex+=1
            bucket[j]-=1
    return arr
</code></pre>
<h1 id="19-æ¡¶æ’åº">1.9 æ¡¶æ’åº</h1>
<figure data-type="image" tabindex="11"><img src="https://www.runoob.com/wp-content/uploads/2019/03/Bucket_sort_1.svg_.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="12"><img src="https://www.runoob.com/wp-content/uploads/2019/03/Bucket_sort_2.svg_.png" alt="img" loading="lazy"></figure>
<h1 id="110-åŸºæ•°æ’åº">1.10 åŸºæ•°æ’åº</h1>
<figure data-type="image" tabindex="13"><img src="https://www.runoob.com/wp-content/uploads/2019/03/radixSort.gif" alt="img" loading="lazy"></figure>
<pre><code class="language-python">def radix(arr):
    
    digit = 0
    max_digit = 1
    max_value = max(arr)
    #æ‰¾å‡ºåˆ—è¡¨ä¸­æœ€å¤§çš„ä½æ•°
    while 10**max_digit &lt; max_value:
        max_digit = max_digit + 1
    
    while digit &lt; max_digit:
        temp = [[] for i in range(10)]
        for i in arr:
            #æ±‚å‡ºæ¯ä¸€ä¸ªå…ƒç´ çš„ä¸ªã€åã€ç™¾ä½çš„å€¼
            t = int((i/10**digit)%10)
            temp[t].append(i)
        
        coll = []
        for bucket in temp:
            for i in bucket:
                coll.append(i)
                
        arr = coll
        digit = digit + 1

    return arr
</code></pre>
]]></content>
    </entry>
</feed>